<!DOCTYPE html>
<html>
<head>
<title>Connection Mechanics Iteration 2</title>
<meta charset="utf-8">
<link rel="stylesheet" href="con1.css">
<style type="text/css" src="con1.css"></style><style>

</style>
<script src="jquery.js" type="text/javascript"></script>
<script type="text/javascript">
    window.onload=init;

    var col = [];

    function tell() {                                    //this is the function that updates .body html from the objects in col. It is called whenever a change is made like, "make()". Then it calls "control()" to display the changes.
        for (var i = 0; i < col.length; i++) {
            col[i].body = col[i].body;
        };
    }

    ct = 0;



// For now, init() just creates a gate for testing purposes.
//    TODO:Examine why does the control() function
function init() {
    var t = new Gate(0, 0, 0, 'init');
    t.bod();

    $('#shp').on('click',function(e){

                //Picks up the click event and uses the coordinates to create a new Gate.
                var cx = e.pageX - document.getElementById("shp").offsetLeft;
                var cy = e.pageY - document.getElementById("shp").offsetTop;

                var c = 0;



                var h = new Gate(cx,cy,0,'g_' + ct);

                h.bod();

                ct++;
                control();
                tell();

            }
    );
}

    /*function make(){
     $('#sop').on('click',function(){
     var cx = e.pageX - document.getElementById("shp").offsetLeft;
     var cy = e.pageY  - document.getElementById("shp").offsetTop;
     })

     }*/

    // bin is an array in which we will put the objects that are to be displayed on the screen.


    function Gate(x,y,state,id){
        this.x = x;
        this.y = y;
        this.r = 20;
        this.input01 = [];
        this.input02 = [];
        this.output = [];
        this.state = state;
        this.id = id;
        this.fill = "";
        this.body = "";


        this.connect = function(gate_out, gate_in){
            if (gate_in.input01[0]){
                gate_in.input02[0] = gate_out;
            }

            else if(gate_in.input02[0]){
                gate_in.input01[0] = gate_out;
            }

            else {
             gate_in.input01[0] = gate_out;
            }
            this.bod();
        };


        this.bod = function(){

            if (this.input01[0] && this.input02[0]){
                this.state = 1;
            }

            else {
                this.state = 0;
            }

            if (this.state == 0){
                this.fill = 'blue';

            }

            if (this.state == 1){
                this.fill = 'red';
            }

            this.body = '<circle id = "' + this.id + '" cx = "' + this.x + '" cy = "' + this.y + '" r = "' + this.r + '" fill = "' + this.fill + '" />';

            // This  push statement pushes the gate into the array (col) which is used as a register of all the gates
            // extant on the screen. Then, control() updates the html for display and tell()



            col.push(this);


control();


        }





//tells one gate to listen to the output of another, that is,
        // it puts the output (gate_out) into the input (gate_in) of another gate. Then it calls the this.bod() to update
        // the html of the object for display.



    }



function control () {                          // this is the function that grabs the html ".body" from all the objects in the "col" array and collects them into the "circs" variable. It then pushes them into the HTML of the page, displaying the objects. the "nn()" function attaches the click handler to any new objects so they will be able to connect().
    gates = "";
    for (var i=0; i<col.length;i++){
        gates +=col[i].body;
    }

    col_list = "<svg id = \"sop\" height=\"500\" width=\"900\" style=\"border: 1px solid red;\">" + gates + "</svg>";
    var y = document.getElementById("shp");
    y.innerHTML = col_list;

    tell();

    /*nn();*/

}
</script>
</head>
<body>
<div id = "shp" >
</div>
<button id="woggle" value="Toggle Wiring" onclick="toggle()">Toggle Wiring</button>
<button id="circ_tog" value ="Toggle Circ1 Making" onclick = "circ_tog()">Toggle Circ1 Making</button>
<button id="not" value ="Toggle Not Making" onclick = "not_tog()">Toggle NOT Making</button>
<button id="not02" value ="Toggle AND Making" onclick = "and_tog()">Toggle AND Making</button>
<button id="or" value="Toggle OR Making" onclick="or_tog()">Toggle OR Making</button>
</body>
</html>