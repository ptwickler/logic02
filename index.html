<!DOCTYPE html>
<html>
<head>
<title>Connection Mechanics Iteration 2</title>
<meta charset="utf-8">
<link rel="stylesheet" href="con1.css">
<style type="text/css" src="con1.css"></style><style>

</style>
<script src="jquery.js" type="text/javascript"></script>
<script type="text/javascript">
/*
* This works like this: When instantiated, the this.bod() is called which figures out what states and colors should be
* in effect based on the state of the input arrays (input01 and input02). Then, tell() is called. Tell calls all the
* .bod() methods for all the objects in array col replaces the existing values (old states of the gates) with the new
* values (new states of the gates). Tell calls control(). Control re-concatenates the Gate.body html and displays it on the
* screen.
*
*/
    window.onload=init;

    // This array is the model for the display. That is, it holds the existing gate objects. Other functions iterate
    // through this array to read the states of those gates.
    var col = [];


    // This function iterates through all the gates in array col and calls their .bod() method to update their states
    // and the .body() property (the html for display).

    function tell() {
       for (var i = 0; i <col.length;i++){
           col[i].bod();
       }

        control();
    }

    // Iterates through the array col and assembles a string of their
    function control () {                          // this is the function that grabs the html ".body" from all the objects in the "col" array and collects them into the "circs" variable. It then pushes them into the HTML of the page, displaying the objects. the "nn()" function attaches the click handler to any new objects so they will be able to connect().
        gates = "";
        for (var i=0; i<col.length;i++){
            gates +=col[i].body;
        }

        col_list = "<svg id = \"sop\" height=\"500\" width=\"900\" style=\"border: 1px solid red;\">" + gates + "</svg>";
        var y = document.getElementById("shp");
        y.innerHTML = col_list;



        /*nn();*/

    }

    ct = 0;



// For now, init() just creates a gate for testing purposes.
//    TODO:Examine why does the control() function
    function init() {
        var t = new Source(10, 10, 0, 'init');
        t.make();

        var u = new Source(40,40,0,'init02');
        u.make();

        $('#shp').on('click',function(e){

                    //Picks up the click event and uses the coordinates to create a new Gate.
                    var cx = e.pageX - document.getElementById("shp").offsetLeft;
                    var cy = e.pageY - document.getElementById("shp").offsetTop;

                    //var c = 0;

                    var h = new Gate(cx,cy,0,'g_' + ct);

                    h.make();

                    ct++;
                    control();
                    tell();

                }
        );
    }


    function Source(x,y,state,id){
        this.x = x;
        this.y = y;
        this.r = 10;
        this.state = state;
        this.id = id;
        this.out_state = state;

        this.make = function(){
            this.bod()
            col.push(this);

            tell();
        };

        this.bod = function(){


            if (this.state == 0){
                this.fill = 'blue';
                this.out_state = 0;

            }

            if (this.state == 1){
                this.fill = 'red';
                this.out_state = 1;
            }

            this.body = '<circle id = "' + this.id + '" cx = "' + this.x + '" cy = "' + this.y + '" r = "' + this.r + '" fill = "' + this.fill + '" />';

        }


    }

    function Gate(x,y,state,id){
        this.x = x;
        this.y = y;
        this.r = 20;
        this.input01 = [];
        this.input02 = [];
        this.output = [];
        this.state = state;
        this.id = id;
        this.fill = "";
        this.body = "";
        this.out_state = 0;


        this.make = function(){
            this.bod()
            col.push(this);

            tell();
        };

        // This connects the gate together. It pushes the output gate into the input array of the input gate. It first
        // checks to see
        this.connect = function(gate_out, gate_in){
            if (gate_in.input01[0]){
                gate_in.input02[0] = gate_out;
            }

            else if(gate_in.input02[0]){
                gate_in.input01[0] = gate_out;
            }

            else if(gate_in.input01[0] && gate_in.input02[0]){
                console.log('full');
            }


            else {
                gate_in.input01[0] = gate_out;
            }
            tell();
        };


        this.bod = function(){

            if ((this.input01[0] && this.input01[0].out_state ==1)  && (this.input02[0] && this.input02[0].out_state == 1)){
                this.state = 1;
                this.out_state = 1;
            }

            else {
                this.state = 0;
            }

            if (this.state == 0){
                this.fill = 'blue';

            }

            if (this.state == 1){
                this.fill = 'red';
            }

            this.body = '<circle id = "' + this.id + '" cx = "' + this.x + '" cy = "' + this.y + '" r = "' + this.r + '" fill = "' + this.fill + '" />';


        }

    }




</script>
</head>
<body>
<div id = "shp" >
</div>
<button id="woggle" value="Toggle Wiring" onclick="toggle()">Toggle Wiring</button>
<button id="circ_tog" value ="Toggle Circ1 Making" onclick = "circ_tog()">Toggle Circ1 Making</button>
<button id="not" value ="Toggle Not Making" onclick = "not_tog()">Toggle NOT Making</button>
<button id="not02" value ="Toggle AND Making" onclick = "and_tog()">Toggle AND Making</button>
<button id="or" value="Toggle OR Making" onclick="or_tog()">Toggle OR Making</button>
</body>
</html>